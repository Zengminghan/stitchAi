**介绍** 

该stitchAi集成上市所有Ai平台，可跨多个平台集成ai答案，亦或者二次或更高级数迭代答案，最后输出答案

**软件架构说明**

该代码实现使用vscode进行，需要自行配置好python环境，搭建好conda，同时配置好python 3.13版本

**使用说明**

在conda中配置好openai，这使得可以调用不同的API
pip install --upgrade openai

**版本迭代**

1.stitchAi尚在开发过程中，目前推出1.0版本

2.stitchAi v1.0中支持一种Ai平台：kimi  

3.在temperature=0.3中，表示该内容输出更具精确性，简洁性，1.0支持自由调节该维度，使得答案根据实际进行你想要的效果

4.目前尚未实现答案的二次迭代，计划于2024年11月中旬实现该答案自动二次迭代并输出，并上架该v1.x

**遇到的问题** 

1.由于目前是通过API来实现问答，导致目前回答字数各方面不好，由kimi单独实现问答会更为差劲（即实现简单问答） 

2.在精确度方面，单个kimi通过API实现问答存在精度不准确的问题 

3.在准确度函数中，还需要进一步优化，以实现更为准确详细的回答

**计划**

1.目前已实现集成文言一心API与kimi实现基本的输出回答，由于1.0只是测试数据，在1.1版本中，可以很明显的感受到集成后会比集成前在语义，问答，格式上具有优势 

2.目前尚未实现答案二次迭代过程（考虑到免费的API本身存在输出语句精度长度较少）所以只能实现答案二次迭代，无法能够证明二次迭代后能否满足字数要求 

3.在1.1版本基础上，希望能够开发出能够集成豆包大模型同时后续版本会推出答案二次迭代增加准确性和精度

后续： 添加对应一个kimiAPI数据进行对比 

**2024年11月5日更新**

字数获取长度建议已放置在包中

**2024年11月6日更新**

修改最佳函数，调用文言一心API进入该集成

**2024年11月9日更新**

修改最佳函数，创建token和if语句来实现最低输出要求

计划：

1.计划推行stitchAi_1.4版本，该版本在上述能够集成完成Ai回答的基础上，实现对文件的集成解读

2.请自行环境配置安装flask

**2024年11月10日更新**

选择测试test.txt文件作为文件测试，尝试解读该文件，并且完成了部分服务器的html制作

计划：

于本周正式预上线stitchAi 1.4 在支持智能问答的基础上完成文件解读

出现的问题：

请注意，在上传时由于只是测试，尽量选择uft-8的文件类型，同时若文件里包含二进制或者非文字会显示读取失败，这是由于无法正常解码造成的

我们会在后续尽快补齐这一漏洞，支持更多形式的文件解读

**2024年11月11日更新**

工作：

1.完成了flask环境配置，并导入库

2.完成了基本的html网页，分为三个：1.首页路由 2.上传路由 3.提问路由

问题：

1.对于html网页不熟悉

2.对于最优函数，上传文件选择抛出异常，该代码被写入了最优函数中，计划后续整改自身代码

**2024年11月12日更新**

工作：

上线stitchAi 1.4 支持文件上传并解读

不足：

1.html过于简单，要优化设计

**2024年11月13日更新**

工作：

1.修改了上传解读文件为json格式，方便后续导出文本

不足：

1.计划周末把网页制作的精致一点

**2024年11月17日更新**

工作：

1.对页面进行了优化，由于Flask属于轻量级网络搭建，可以适用于嵌入式开发

不足：

1.思考如何把答案形成文本文件输出出来

**2024年11月20日更新**

工作：

完成了基本页面美化设计

不足：

还需尽快开发后续功能

**2024年11月25日更新**

工作：

1.完成了基本的问答和文件解读后将答案以docx与txt文件形式重新返回至本地

2.完成了用户交互时抛出提示，如果用户在还未上传文件或者还未输入问题就开始解读与回答时会抛出异常

不足：

对于由Ai完成的答案，具有明显倾向性：（下面举一个例子）

西南科技大学，xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx。

--地理位置--  xxxxxxxxxxxxxxxxxxx

--基本介绍--  xxxxxxxxxxxxxxxxxx

西南科技大学是一所xxxxxxxxxxxxxxxxxxxxxxxx。

因此我们希望的集成后的stitchAi能够自主的去掉烦人的符号，因此在生成文本文档时我们可以增加去Ai功能，实现方法：

1.在生成文本文档后，检索每一行，如果出现了“*”字符，则把整个一行注释掉，并截取从这行“*’”到下一个“*”这段文字，集成多个ai补充内容；在返回这些文字

2.基于很多Ai在总结时具有明显倾向性：如：西南科技大学xxx，英雄联盟xxx，总的来说xxx，重复性很高，只要设计一个函数，选择多个Ai的最后一段，把开头重复率高的词汇进行一个修改（目前尚未实现）

**2024年11月30日更新**

工作：

1.根据调试，需要尽可能的修改好优化函数，这是个最优化组合问题，也是经典的DP问题

2.查阅论文文献，可从KKT条件入手（解决经典DP的基本模型）

计划：

1.优化函数引入KKT条件，只要字数精度未达到要求，惩罚权重就增大，字数精度达到要求，则降低

2.将惩罚权重按类划分，惩罚越大越放入表的前面，表明需要迭代次数越多

**2024年12月5日更新**

工作：

1.引入了KKT条件约束，用于生成更好的文本，这里后续会加上自然语言处理大模型;

**基本思路**

1.考虑将KKT条件应用到“生成最优答案”的过程中，假设你有多个目标（如生成文本的长度、相关性、流畅性等）

并且这些目标有相应的约束条件。例如，可能希望生成一个不仅具有合理长度、相关性和多样性，还能满足一定的约束条件（如避免某些关键词、限制某些内容等）。

2.构建优化模型：
f(x)=α⋅Length(x)+β⋅Relevance(x)
其中，α和𝛽是权重系数，Length(x)表示文本的长度，Relevance(x)表示文本的相关性。然后，设置一些约束条件：
Length(𝑥)≥𝐿min(长度约束)
Words_in_forbidden_list(𝑥)=0(禁止词汇约束)

3.代码实现：
# 目标函数：最大化文本的长度和相关性
    length_score = len(merged_response)
    relevance_score = self.calculate_relevance_score(merged_response, message)  # 计算相关性

    # 约束条件：确保回答长度不小于100个字符
    if length_score < 100:
        merged_response += " 这是为了增加回答的长度而添加的额外内容。"

    # 如果满足约束条件，返回优化后的结果
    return merged_response if merged_response else "对不起，我无法回答您的问题。"

def calculate_relevance_score(self, response, query):
    # 计算回答的相关性，这里可以通过模型进行评估或简单的文本匹配
    return 0.8  # 假设的相关性得分，实际应该根据具体算法计算

在这个示例中：

calculate_relevance_score是一个示例方法，用于计算生成文本和问题的相关性。可以用自然语言处理模型来计算相关性分数。
如果生成的文本不符合长度要求，就会通过附加额外内容来满足约束。
目标函数会根据文本长度和相关性来决定最优的输出。

**2024年12月9日更新**

目前文言一心由于v1版本换至v2版本，文档api讲不再保存原先api+access_token的模式，请自行按照官方文档格式换至v2

# 流程：
![image](https://github.com/user-attachments/assets/e8d68681-5847-4741-b1be-7beb1afe1490)

# 效果展示：
![image](https://github.com/user-attachments/assets/592f5ec5-9c25-4d7e-8f52-f7af73fb2a9d)
![image](https://github.com/user-attachments/assets/5f4d2555-c8fd-4fba-9646-4a1157604edb)

未完待续-----------------------------------------------------------------------------------------------------

**最后**

注意

stitchAi会不断更新自身已有的最优函数，同时把Ai平台的chatmessage信息传递选择做一个基础上传，这里即可以修改既定参数，又可以选择自身重构，欢迎各位能够提出宝贵的建议。

上传文件名：最优函数调整.txt

stitchAi在文件中提供了一个形式为文本文档的数据测试，这是为了测试环境能否接收该uft-8文件并进行解读，也同时欢迎各位能够重构并帮助stitchAi提供更多的形式文件。

上传文件名：test.txt

另外stitchAi由于只是基于测试环境，对于各大Ai平台提供的免费基础版API无法做到多字数，我们在最优化函数测试了合并输出，这样就会舍弃到精确度重复度问题，您可以选择在自己想要集成的Ai平台开通更加强大的API，也可以自身重构最优输出函数来辅助，stitchAi只负责提供提供可以集成的模板，文中的API是基于kimi与文言一心的大模型，如有需要请置换为自己的API，我们已将建议写至字数建议，感谢您的理解！

上传文件名：字数建议.txt
